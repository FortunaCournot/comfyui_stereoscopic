name: Install Test (Develop)

on:
  push:
    branches:
      - develop

jobs:
  test-installation:
    name: Test Installation on Windows
    runs-on: windows-latest

    env:
      INSTALL_DIR: C:\Users\runneradmin\AppData\Local

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Verify Git Installation
        shell: cmd
        run: |
          git --version

      - name: Verify 7-Zip Installation
        shell: cmd
        run: |
          "C:\Program Files\7-Zip\7z.exe" i

      - name: Ensure FFmpeg is installed
        shell: cmd
        run: |
          choco install ffmpeg -y

      - name: Verify FFmpeg Installation
        shell: cmd
        run: |
          ffmpeg -version

      - name: Setup Python 3.13
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      - name: Verify Python Version (pre-install)
        shell: cmd
        run: |
          echo Überprüfe Python vor der Installation:
          python --version

      - name: Run Installation Script
        shell: cmd
        run: |
          echo Starte Installationsskript mit Ziel: %INSTALL_DIR%
          call installer\VrWeAre-Installer.bat "%INSTALL_DIR%"

      - name: Verify Installation Directory
        shell: cmd
        run: |
          if exist "%INSTALL_DIR%" (
              echo Installationsverzeichnis gefunden: %INSTALL_DIR%
          ) else (
              echo Installationsverzeichnis fehlt. && exit /b 1
          )

      - name: Verify Python Detection (post-install)
        shell: cmd
        run: |
          echo Überprüfe, ob Installation Python korrekt erkennt:
          python --version
          for /f "tokens=2 delims= " %%v in ('python --version 2^>^&1') do (
              echo Erkannte Python-Version: %%v
              if not "%%v"=="3.13." (
                  echo Falsche Python-Version erkannt. && exit /b 1
              )
          )
